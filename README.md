# NeuroMemory

**AI Agent å¤šå±‚è®°å¿†æ¡†æ¶**

åŸºäº PostgreSQL æ„å»ºçš„ Python è®°å¿†åº“ï¼Œä¸º AI agent æä¾›å¼€ç®±å³ç”¨çš„å¤šå±‚è®°å¿†ã€‚åˆ©ç”¨ PostgreSQL ç”Ÿæ€ pgvector å‘é‡æ£€ç´¢ã€pg_search å…¨æ–‡æ£€ç´¢ã€å›¾æ£€ç´¢ã€KV æ£€ç´¢ç­‰èƒ½åŠ›å®ç°æ··åˆè®°å¿†æ£€ç´¢ã€‚

- `add_message()` è‡ªåŠ¨æå–å››ç§è®°å¿†ï¼š**Fact**ï¼ˆæŒä¹…äº‹å®ï¼‰ã€**Episode**ï¼ˆå¸¦æ—¶é—´æˆ³çš„æƒ…æ™¯è®°å¿†ï¼‰ã€**Graph**ï¼ˆå®ä½“å…³ç³»å›¾è°±ï¼‰ã€**UserProfile**ï¼ˆç”¨æˆ·ç”»åƒï¼‰
- `reflect()` è‡ªåŠ¨å‘¨æœŸæ€§åæ€ï¼Œä»å¤šè½®å¯¹è¯ä¸­è‡ªåŠ¨æå– **Insight**ï¼ˆç”¨æˆ·æ´å¯Ÿï¼Œå¦‚è¡Œä¸ºæ¨¡å¼ã€æƒ…æ„Ÿç”»åƒï¼‰
- `recall()` å°†å¤šå±‚è®°å¿†èåˆæ’åºåè¿”å›ï¼Œé›¶é¢å¤–ä»£ç ç»„è£…è¿› prompt

---

## LoCoMo åŸºå‡†æµ‹è¯•æˆç»©

åœ¨ [LoCoMo é•¿å¯¹è¯è®°å¿†åŸºå‡†](https://arxiv.org/abs/2309.11696)ï¼ˆACL 2024ï¼‰ä¸Šçš„å¯¹æ¯”æˆç»©ï¼ˆJudge: GPT-4o-miniï¼‰ï¼š

| æ¡†æ¶ | Single-Hop | Multi-Hop | Open-Dom | Temporal | Overall |
|------|:---:|:---:|:---:|:---:|:---:|
| memU | â€” | â€” | â€” | â€” | 92.1% |
| Backboard | 89.4% | 75.0% | 91.2% | 91.9% | 90.0% |
| **NeuroMemory** | **87.1%** | **80.9%** | **81.9%** | **71.6%** | **80.2%** |
| MemOS | â€” | â€” | â€” | â€” | 75.8% |
| Memobase v0.0.37 | 70.9% | 46.9% | 77.2% | 85.1% | 75.8% |
| Zep | 74.1% | 66.0% | 67.7% | 79.8% | 75.1% |
| Letta | â€” | â€” | â€” | â€” | 74.0% |
| Mem0-Graph | 65.7% | 47.2% | 75.7% | 58.1% | 68.4% |
| Mem0 | 67.1% | 51.2% | 72.9% | 55.5% | 66.9% |
| LangMem | 62.2% | 47.9% | 71.1% | 23.4% | 58.1% |
| OpenAI Memory | 63.8% | 42.9% | 62.3% | 21.7% | 52.9% |

> å„æ¡†æ¶ä½¿ç”¨ä¸åŒçš„ Judge LLMï¼Œåˆ†æ•°ä¸å®Œå…¨å¯æ¯”ã€‚è¯¦è§ [LoCoMo ä¼˜åŒ–å†ç¨‹](evaluation/history/OPTIMIZATION_HISTORY.md)ã€‚

---

## å®‰è£…

### æ–¹å¼ 1: ä» PyPI å®‰è£…ï¼ˆæ¨èï¼‰

```bash
# åŸºç¡€å®‰è£…ï¼ˆåŒ…å«æ ¸å¿ƒåŠŸèƒ½ï¼‰
pip install neuromemory

# æˆ–å®‰è£…æ‰€æœ‰å¯é€‰ä¾èµ–ï¼ˆæ¨èï¼‰
pip install neuromemory[all]
```

**ä¾èµ–è‡ªåŠ¨å®‰è£…**: SQLAlchemyã€asyncpgã€pgvectorã€httpx ç­‰æ ¸å¿ƒä¾èµ–ä¼šè‡ªåŠ¨å®‰è£…ã€‚

### æ–¹å¼ 2: ä»æºç å®‰è£…ï¼ˆå¼€å‘è€…ï¼‰

```bash
git clone https://github.com/yourusername/NeuroMemory
cd NeuroMemory
pip install -e ".[dev]"  # åŒ…å«æµ‹è¯•å·¥å…·
```

---

## å¤–éƒ¨ä¾èµ–

NeuroMemory éœ€è¦ä»¥ä¸‹å¤–éƒ¨æœåŠ¡ï¼ˆ**ä¸åŒ…å«åœ¨ pip åŒ…ä¸­**ï¼‰ï¼š

### 1. PostgreSQL 18 + pgvector + pg_searchï¼ˆå¿…éœ€ï¼‰

NeuroMemory ä½¿ç”¨ [ParadeDB](https://www.paradedb.com/) é•œåƒï¼Œå†…ç½® PostgreSQL 18ã€pgvector å’Œ pg_searchï¼ˆBM25 å…¨æ–‡æ£€ç´¢ï¼‰ã€‚

```bash
# ä½¿ç”¨é¡¹ç›®æä¾›çš„ Docker Composeï¼ˆæ¨èï¼‰
docker compose -f docker-compose.yml up -d db
```

> **pg_search è¯´æ˜**ï¼špg_search æä¾› BM25 å…³é”®è¯æ£€ç´¢ï¼Œä¸å‘é‡æ£€ç´¢èåˆä¸ºæ··åˆæ’åºï¼ˆRRFï¼‰ã€‚è‹¥ pg_search ä¸å¯ç”¨ï¼Œç³»ç»Ÿè‡ªåŠ¨é™çº§åˆ° PostgreSQL å†…ç½®çš„ tsvector å…¨æ–‡æ£€ç´¢ï¼ŒåŠŸèƒ½ä»å¯æ­£å¸¸ä½¿ç”¨ã€‚

### 2. Embedding Providerï¼ˆå¿…éœ€ï¼Œä¸‰é€‰ä¸€ï¼‰

- **æœ¬åœ°æ¨¡å‹**ï¼ˆæ— éœ€ API Keyï¼‰ï¼š`pip install sentence-transformers`ï¼Œä½¿ç”¨æœ¬åœ° transformer æ¨¡å‹
- **SiliconFlow**ï¼š[siliconflow.cn](https://siliconflow.cn/)ï¼Œéœ€è¦ API Key
- **OpenAI**ï¼š[platform.openai.com](https://platform.openai.com/)ï¼Œéœ€è¦ API Key

### 3. LLM API Keyï¼ˆç”¨äºè‡ªåŠ¨æå–è®°å¿†ï¼Œå¯é€‰ï¼‰

- [OpenAI](https://platform.openai.com/) æˆ– [DeepSeek](https://platform.deepseek.com/)
- ä¸ä½¿ç”¨ LLM æ—¶ï¼Œä»å¯æ‰‹åŠ¨é€šè¿‡ `add_memory()` æ·»åŠ è®°å¿†å¹¶ç”¨ `recall()`/`search()` æ£€ç´¢

### 4. MinIO/S3ï¼ˆå¯é€‰ï¼Œä»…ç”¨äºæ–‡ä»¶å­˜å‚¨ï¼‰

```bash
docker compose -f docker-compose.yml up -d minio
```

---

## å¿«é€Ÿå¼€å§‹

```python
import asyncio
from neuromemory import NeuroMemory, SiliconFlowEmbedding, OpenAILLM

async def main():
    async with NeuroMemory(
        database_url="postgresql+asyncpg://neuromemory:neuromemory@localhost:5432/neuromemory",
        embedding=SiliconFlowEmbedding(api_key="your-key"),
        llm=OpenAILLM(api_key="your-openai-key"),  # ç”¨äºè‡ªåŠ¨æå–è®°å¿†
        auto_extract=True,  # é»˜è®¤å¯ç”¨ï¼Œåƒ mem0 é‚£æ ·å®æ—¶æå–è®°å¿†
    ) as nm:
        # 1. å­˜å‚¨å¯¹è¯æ¶ˆæ¯ â†’ è‡ªåŠ¨æå–è®°å¿†ï¼ˆfacts/episodes/relationsï¼‰
        await nm.conversations.add_message(
            user_id="alice", role="user",
            content="I work at ABC Company as a software engineer"
        )
        # â†’ åå°è‡ªåŠ¨æå–ï¼šfact: "åœ¨ ABC Company å·¥ä½œ", relation: (alice)-[works_at]->(ABC Company)

        # 2. ä¸‰å› å­æ£€ç´¢ï¼ˆç›¸å…³æ€§ Ã— æ—¶æ•ˆæ€§ Ã— é‡è¦æ€§ï¼‰
        result = await nm.recall(user_id="alice", query="Where does Alice work?")
        for r in result["merged"]:
            print(f"[{r['score']:.2f}] {r['content']}")

        # 3. ç”Ÿæˆæ´å¯Ÿå’Œæƒ…æ„Ÿç”»åƒï¼ˆå¯é€‰ï¼Œå®šæœŸè°ƒç”¨ï¼‰
        insights = await nm.reflect(user_id="alice")
        print(f"ç”Ÿæˆäº† {insights['insights_generated']} æ¡æ´å¯Ÿ")

asyncio.run(main())
```

### æ ¸å¿ƒæ“ä½œæµç¨‹

NeuroMemory çš„æ ¸å¿ƒä½¿ç”¨å›´ç»•ä¸‰ä¸ªæ“ä½œï¼š

**æ’å…¥è®°å¿†**ï¼ˆè‡ªåŠ¨æ¨¡å¼ï¼Œé»˜è®¤ï¼‰ï¼š
- å¯¹è¯é©±åŠ¨ï¼š`add_message()` å­˜å‚¨å¯¹è¯ **å¹¶è‡ªåŠ¨æå–è®°å¿†**ï¼ˆæ¨èï¼Œåƒ mem0ï¼‰
- ç›´æ¥æ·»åŠ ï¼š`add_memory(user_id, content, memory_type)`ï¼ˆæ‰‹åŠ¨æŒ‡å®šç±»å‹ï¼Œä¸éœ€è¦ LLMï¼‰

**å¬å›è®°å¿†ï¼ˆrecallï¼‰**ï¼š
- `await nm.recall(user_id, query)` â€” ç»¼åˆè€ƒè™‘ç›¸å…³æ€§ã€æ—¶æ•ˆæ€§ã€é‡è¦æ€§ï¼Œæ‰¾å‡ºæœ€åŒ¹é…çš„è®°å¿†
- åœ¨å¯¹è¯ä¸­ä½¿ç”¨ï¼šè®© agent èƒ½"æƒ³èµ·"ç›¸å…³çš„å†å²ä¿¡æ¯æ¥å›åº”ç”¨æˆ·

**ç”Ÿæˆæ´å¯Ÿï¼ˆreflectï¼‰**ï¼ˆå¯é€‰ï¼Œå®šæœŸè°ƒç”¨ï¼‰ï¼š
- `await nm.reflect(user_id)` â€” é«˜å±‚è®°å¿†åˆ†æï¼š
  1. **æç‚¼æ´å¯Ÿ**ï¼šä»å·²æå–çš„è®°å¿†ç”Ÿæˆé«˜å±‚ç†è§£ï¼ˆè¡Œä¸ºæ¨¡å¼ã€é˜¶æ®µæ€»ç»“ï¼‰
  2. **æ›´æ–°ç”»åƒ**ï¼šæ•´åˆæƒ…æ„Ÿæ•°æ®ï¼Œæ›´æ–°ç”¨æˆ·æƒ…æ„Ÿç”»åƒ
- è®©è®°å¿†ä»"äº‹å®"å‡åä¸º"æ´å¯Ÿ"

> `add_message()` é»˜è®¤ `auto_extract=True`ï¼Œæ¯æ¬¡è°ƒç”¨è‡ªåŠ¨æå–è®°å¿†ã€‚`reflect()` ä¸“æ³¨äºç”Ÿæˆ Insight å’Œæ›´æ–°æƒ…æ„Ÿç”»åƒï¼Œä¸å¤„ç†åŸºç¡€è®°å¿†æå–ã€‚

**é€»è¾‘å…³ç³»**ï¼š
```
å¯¹è¯è¿›è¡Œä¸­ â†’ å­˜å‚¨æ¶ˆæ¯ (add_message) â†’ è‡ªåŠ¨æå–è®°å¿†
     â†“
agent éœ€è¦ä¸Šä¸‹æ–‡ â†’ å¬å›è®°å¿† (recall)
     â†“
å®šæœŸåˆ†æ â†’ ç”Ÿæˆæ´å¯Ÿ (reflect) â†’ æ´å¯Ÿ + æƒ…æ„Ÿç”»åƒ
```

**é…ç½®é€‰é¡¹**ï¼š
- **è‡ªåŠ¨æ¨¡å¼**ï¼ˆé»˜è®¤ï¼Œæ¨èï¼‰ï¼š`auto_extract=True`ï¼Œæ¯æ¬¡ `add_message` éƒ½æå–è®°å¿†
- **è‡ªåŠ¨æ¨¡å¼ + åå° reflect**ï¼š`auto_extract=True, reflection_interval=20`ï¼Œæ¯ 20 æ¬¡æå–åè‡ªåŠ¨åå° reflectï¼Œæ— é˜»å¡
- **æ‰‹åŠ¨æ¨¡å¼**ï¼š`auto_extract=False`ï¼Œæ‰‹åŠ¨è°ƒç”¨ `extract_memories()`

---

## æ ¸å¿ƒç‰¹æ€§

### è®°å¿†åˆ†ç±»

NeuroMemory æä¾› 7 ç§è®°å¿†ç±»å‹ï¼Œæ¯ç§æœ‰ä¸åŒçš„å­˜å‚¨å’Œè·å–æ–¹å¼ï¼š

| è®°å¿†ç±»å‹ | å­˜å‚¨æ–¹å¼ | åº•å±‚å­˜å‚¨ | è·å–æ–¹å¼ | ç¤ºä¾‹ |
|---------|---------|---------|---------|------|
| **äº‹å®** | Embedding + Graph | pgvector + å…³ç³»è¡¨ | `nm.recall(user_id, query)` | "åœ¨ Google å·¥ä½œ" |
| **æƒ…æ™¯** | Embedding | pgvector | `nm.recall(user_id, query)` | "æ˜¨å¤©é¢è¯•å¾ˆç´§å¼ " |
| **å…³ç³»** | Graph Store | PostgreSQL å…³ç³»è¡¨ | `nm.graph.get_neighbors(user_id, type, id)` | `(user)-[works_at]->(Google)` |
| **æ´å¯Ÿ** | Embedding | pgvector | `nm.search(user_id, query, memory_type="insight")` | "ç”¨æˆ·å€¾å‘äºæ™šä¸Šå·¥ä½œ" |
| **æƒ…æ„Ÿç”»åƒ** | Table | PostgreSQL | `reflect()` è‡ªåŠ¨æ›´æ–° | "å®¹æ˜“ç„¦è™‘ï¼Œå¯¹æŠ€æœ¯å…´å¥‹" |
| **åå¥½** | KV (Profile) | PostgreSQL | `nm.kv.get(user_id, "profile", "preferences")` | `["å–œæ¬¢å–å’–å•¡", "åå¥½æ·±è‰²æ¨¡å¼"]` |
| **é€šç”¨** | Embedding | pgvector | `nm.search(user_id, query)` | æ‰‹åŠ¨ `add_memory()` çš„å†…å®¹ |

### ä¸‰å› å­æ··åˆæ£€ç´¢

ä¸æ˜¯ç®€å•çš„å‘é‡æ•°æ®åº“å°è£…ã€‚`recall()` ç»¼åˆä¸‰ä¸ªå› å­è¯„åˆ†å¹¶èåˆå›¾è°±éå†ï¼š

```python
Score = rrf_score Ã— recency Ã— importance

rrf_score  = RRF(vector_rank, bm25_rank)                 # å‘é‡ + BM25 å…³é”®è¯æ··åˆæ£€ç´¢ (RRF èåˆ)
recency    = e^(-t / decay_rate Ã— (1 + arousal Ã— 0.5))   # æ—¶æ•ˆæ€§ï¼Œé«˜æƒ…æ„Ÿå”¤é†’è¡°å‡æ›´æ…¢
importance = metadata.importance / 10                     # LLM è¯„ä¼°çš„é‡è¦æ€§ (0.1-1.0)
```

| å¯¹æ¯”ç»´åº¦ | çº¯å‘é‡æ£€ç´¢ | ä¸‰å› å­æ£€ç´¢ |
|---------|-----------|-----------|
| **æ—¶é—´æ„ŸçŸ¥** | âŒ 1 å¹´å‰å’Œæ˜¨å¤©çš„æƒé‡ç›¸åŒ | âœ… æŒ‡æ•°è¡°å‡ï¼ˆEbbinghaus é—å¿˜æ›²çº¿ï¼‰ |
| **æƒ…æ„Ÿå½±å“** | âŒ ä¸è€ƒè™‘æƒ…æ„Ÿå¼ºåº¦ | âœ… é«˜ arousal è®°å¿†è¡°å‡æ…¢ 50% |
| **é‡è¦æ€§** | âŒ çäº‹å’Œå¤§äº‹åŒç­‰å¯¹å¾… | âœ… é‡è¦äº‹ä»¶ä¼˜å…ˆçº§æ›´é«˜ |

**å®é™…æ¡ˆä¾‹** â€” ç”¨æˆ·é—®"æˆ‘åœ¨å“ªå·¥ä½œï¼Ÿ"ï¼š

| è®°å¿†å†…å®¹ | æ—¶é—´ | çº¯å‘é‡ | ä¸‰å› å­ | åº”è¯¥è¿”å› |
|---------|------|--------|--------|---------|
| "æˆ‘åœ¨ Google å·¥ä½œ" | 1 å¹´å‰ | 0.95 | 0.008 | âŒ å·²è¿‡æ—¶ |
| "ä¸Šå‘¨ä» Google ç¦»èŒäº†" | 7 å¤©å‰ | 0.85 | 0.67 | âœ… æœ€æ–°ä¸”é‡è¦ |

**å›¾å®ä½“æ£€ç´¢**ï¼šä»çŸ¥è¯†å›¾è°±ä¸­æŸ¥æ‰¾ç»“æ„åŒ–å…³ç³»ï¼ˆ`(alice)-[works_at]->(Google)`ï¼‰ï¼Œä¸å‘é‡ç»“æœå»é‡åˆå¹¶ã€‚`recall()` è¿”å› `vector_results`ã€`graph_results` å’Œåˆå¹¶åçš„ `merged` åˆ—è¡¨ã€‚

### ä¸‰å±‚æƒ…æ„Ÿæ¶æ„

å”¯ä¸€å®ç°ä¸‰å±‚æƒ…æ„Ÿè®¾è®¡çš„å¼€æºè®°å¿†æ¡†æ¶ï¼š

| å±‚æ¬¡ | ç±»å‹ | å­˜å‚¨ä½ç½® | æ—¶é—´æ€§ | ç¤ºä¾‹ |
|------|------|---------|--------|------|
| **å¾®è§‚** | äº‹ä»¶æƒ…æ„Ÿæ ‡æ³¨ | è®°å¿† metadata (valence/arousal/label) | ç¬æ—¶ | "è¯´åˆ°é¢è¯•æ—¶å¾ˆç´§å¼ (valence=-0.6)" |
| **ä¸­è§‚** | è¿‘æœŸæƒ…æ„ŸçŠ¶æ€ | emotion_profiles.latest_state | 1-2å‘¨ | "æœ€è¿‘å·¥ä½œå‹åŠ›å¤§ï¼Œæƒ…ç»ªä½è½" |
| **å®è§‚** | é•¿æœŸæƒ…æ„Ÿç”»åƒ | emotion_profiles.* | é•¿æœŸç¨³å®š | "å®¹æ˜“ç„¦è™‘ï¼Œä½†å¯¹æŠ€æœ¯è¯é¢˜å…´å¥‹" |

- å¾®è§‚ï¼šæ•æ‰ç¬æ—¶æƒ…æ„Ÿï¼Œä¸°å¯Œè®°å¿†ç»†èŠ‚
- ä¸­è§‚ï¼šè¿½è¸ªè¿‘æœŸçŠ¶æ€ï¼Œagent å¯ä»¥å…³å¿ƒ"ä½ æœ€è¿‘è¿˜å¥½å—"
- å®è§‚ï¼šç†è§£é•¿æœŸç‰¹è´¨ï¼Œå½¢æˆçœŸæ­£çš„ç”¨æˆ·ç”»åƒ

> **éšç§åˆè§„**ï¼šä¸è‡ªåŠ¨æ¨æ–­ç”¨æˆ·äººæ ¼ (Big Five) æˆ–ä»·å€¼è§‚ã€‚EU AI Act Article 5 ç¦æ­¢æ­¤ç±»è‡ªåŠ¨åŒ–ç”»åƒã€‚äººæ ¼å’Œä»·å€¼è§‚åº”ç”±å¼€å‘è€…é€šè¿‡ system prompt è®¾å®š agent è§’è‰²ã€‚

### LLM é©±åŠ¨çš„è®°å¿†æå–ä¸åæ€

- **æå–** (`extract_memories`)ï¼šä»å¯¹è¯ä¸­è‡ªåŠ¨è¯†åˆ«äº‹å®ã€äº‹ä»¶ã€å…³ç³»ï¼Œé™„å¸¦æƒ…æ„Ÿæ ‡æ³¨ï¼ˆvalence/arousal/labelï¼‰å’Œé‡è¦æ€§è¯„åˆ†ï¼ˆ1-10ï¼‰ï¼Œåå¥½å­˜å…¥ç”¨æˆ·ç”»åƒ
- **åæ€** (`reflect`)ï¼šå®šæœŸä»è¿‘æœŸè®°å¿†æç‚¼é«˜å±‚æ´å¯Ÿï¼ˆè¡Œä¸ºæ¨¡å¼ã€é˜¶æ®µæ€»ç»“ï¼‰ï¼Œæ›´æ–°æƒ…æ„Ÿç”»åƒ
- **è®¿é—®è¿½è¸ª**ï¼šè‡ªåŠ¨è®°å½• access_count å’Œ last_accessed_atï¼Œç¬¦åˆ ACT-R è®°å¿†æ¨¡å‹

ç†è®ºåŸºç¡€ï¼šGenerative Agents (Park 2023) çš„ Reflection æœºåˆ¶ + LeDoux æƒ…æ„Ÿæ ‡è®° + Ebbinghaus é—å¿˜æ›²çº¿ + ACT-R è®°å¿†æ¨¡å‹ã€‚

### ä¸åŒç±»æ¡†æ¶å¯¹æ¯”

| ç‰¹æ€§ | NeuroMemory | Mem0 | LangChain Memory |
|------|------------|------|-----------------|
| ä¸‰å±‚æƒ…æ„Ÿæ¶æ„ | âœ… å¾®è§‚+ä¸­è§‚+å®è§‚ | âŒ | âŒ |
| æƒ…æ„Ÿæ ‡æ³¨ | âœ… valence/arousal/label | âŒ | âŒ |
| é‡è¦æ€§è¯„åˆ† + ä¸‰å› å­æ£€ç´¢ | âœ… | ğŸ”¶ æœ‰è¯„åˆ† | âŒ |
| åæ€æœºåˆ¶ | âœ… æ´å¯Ÿ + ç”»åƒæ›´æ–° | âŒ | âŒ |
| çŸ¥è¯†å›¾è°± | âœ… å…³ç³»è¡¨å›¾è°±ï¼ˆæ—  Cypher ä¾èµ–ï¼‰ | ğŸ”¶ ç®€å•å›¾ | ğŸ”¶ LangGraph |
| å¤šæ¨¡æ€æ–‡ä»¶ | âœ… PDF/DOCX æå– | âœ… | âŒ |
| æ¡†æ¶åµŒå…¥ | âœ… Python åº“ | âœ… | âœ… |
| éšç§åˆè§„ | âœ… ä¸æ¨æ–­äººæ ¼ | â“ | â“ |

---

## API ä½¿ç”¨è¯´æ˜

> å®Œæ•´ API å‚è€ƒæ–‡æ¡£è§ **[docs/API.md](docs/API.md)**ï¼ŒåŒ…å«æ‰€æœ‰æ–¹æ³•çš„ç­¾åã€å‚æ•°ã€è¿”å›å€¼å’Œç¤ºä¾‹ã€‚

NeuroMemory æœ‰ä¸‰ç»„å®¹æ˜“æ··æ·†çš„ APIï¼Œä»¥ä¸‹æ˜¯å¿«é€Ÿå¯¹æ¯”ï¼š

### âœï¸ å†™å…¥ APIï¼šadd_message() vs add_memory()

| API | ç”¨é€” | å†™å…¥ç›®æ ‡ | ä½•æ—¶ä½¿ç”¨ |
|-----|------|---------|---------|
| **add_message()** â­ | å­˜å‚¨å¯¹è¯æ¶ˆæ¯ï¼Œè‡ªåŠ¨æå–è®°å¿† | å¯¹è¯å†å² + è®°å¿†è¡¨ï¼ˆè‡ªåŠ¨æå–ï¼‰ | **æ—¥å¸¸ä½¿ç”¨ï¼ˆæ¨èï¼‰** |
| **add_memory()** | ç›´æ¥å†™å…¥è®°å¿† | è®°å¿†è¡¨ï¼ˆembeddingï¼‰ï¼Œç«‹å³å¯æ£€ç´¢ | æ‰‹åŠ¨å¯¼å…¥ã€æ‰¹é‡åˆå§‹åŒ–ã€å·²çŸ¥ç»“æ„åŒ–ä¿¡æ¯ |

```python
# add_message(): å¯¹è¯é©±åŠ¨ï¼ˆæ¨èï¼‰â€” å­˜å‚¨åŒæ—¶è‡ªåŠ¨æå–è®°å¿†
await nm.conversations.add_message(user_id="alice", role="user",
    content="æˆ‘åœ¨ Google å·¥ä½œï¼Œåšåç«¯å¼€å‘")
# â†’ è‡ªåŠ¨æå–: fact: "åœ¨ Google å·¥ä½œ" + æƒ…æ„Ÿæ ‡æ³¨ + é‡è¦æ€§è¯„åˆ†

# add_memory(): ç›´æ¥å†™å…¥ï¼ˆæ‰‹åŠ¨æŒ‡å®šä¸€åˆ‡ï¼Œä¸éœ€è¦ LLMï¼‰
await nm.add_memory(user_id="alice", content="åœ¨ Google å·¥ä½œ",
    memory_type="fact", metadata={"importance": 8})
```

### ğŸ“š æ£€ç´¢ APIï¼šrecall() vs search()

| API | ç”¨é€” | æ£€ç´¢æ–¹å¼ | ä½•æ—¶ä½¿ç”¨ |
|-----|------|---------|---------|
| **recall()** â­ | æ™ºèƒ½æ··åˆæ£€ç´¢ | ä¸‰å› å­å‘é‡ï¼ˆç›¸å…³æ€§Ã—æ—¶æ•ˆÃ—é‡è¦æ€§ï¼‰+ å›¾å®ä½“æ£€ç´¢ + å»é‡ | **æ—¥å¸¸ä½¿ç”¨ï¼ˆæ¨èï¼‰** |
| **search()** | çº¯è¯­ä¹‰æ£€ç´¢ | ä»… embedding ä½™å¼¦ç›¸ä¼¼åº¦ | åªéœ€è¯­ä¹‰ç›¸ä¼¼åº¦ï¼Œä¸è€ƒè™‘æ—¶é—´å’Œé‡è¦æ€§ |

```python
# recall(): ç»¼åˆè€ƒè™‘ï¼Œæœ€è¿‘çš„é‡è¦è®°å¿†ä¼˜å…ˆ
result = await nm.recall(user_id="alice", query="å·¥ä½œ")
# â†’ "æ˜¨å¤©é¢è¯• Google"ï¼ˆæœ€è¿‘ + é‡è¦ï¼‰ä¼˜å…ˆäº "å»å¹´åœ¨å¾®è½¯å®ä¹ "ï¼ˆä¹…è¿œï¼‰

# search(): åªçœ‹è¯­ä¹‰ï¼Œå¯èƒ½è¿”å›å¾ˆä¹…ä»¥å‰çš„è®°å¿†
results = await nm.search(user_id="alice", query="å·¥ä½œ")
# â†’ "å»å¹´åœ¨å¾®è½¯å®ä¹ " å’Œ "æ˜¨å¤©é¢è¯• Google" éƒ½å¯èƒ½è¿”å›ï¼ŒåªæŒ‰ç›¸ä¼¼åº¦æ’åº
```

### ğŸ§  è®°å¿†ç®¡ç† APIï¼šreflect() vs extract_memories()

| API | ç”¨é€” | å¤„ç†å†…å®¹ | ä½•æ—¶ä½¿ç”¨ |
|-----|------|---------|---------|
| **reflect()** â­ | æ´å¯Ÿ + ç”»åƒæ›´æ–° | ä»å·²æœ‰è®°å¿†ç”Ÿæˆ Insightï¼ˆè¡Œä¸ºæ¨¡å¼ã€é˜¶æ®µæ€»ç»“ï¼‰+ æ›´æ–°æƒ…æ„Ÿç”»åƒ | å®šæœŸè°ƒç”¨ï¼ˆé»˜è®¤æ¯ 20 æ¡æ¶ˆæ¯åå°è‡ªåŠ¨è§¦å‘ï¼‰ |
| **extract_memories()** | ä»…æå–æ–°è®°å¿† | ä»å¯¹è¯ä¸­æå–äº‹å®/æƒ…æ™¯/å…³ç³»ï¼ˆä¸ç”Ÿæˆæ´å¯Ÿï¼‰ | åº•å±‚æ–¹æ³•ï¼Œé€šå¸¸ä¸éœ€ç›´æ¥è°ƒç”¨ï¼ˆadd_message è‡ªåŠ¨è§¦å‘ï¼‰ |

```python
# reflect(): ç”Ÿæˆæ´å¯Ÿ + æ›´æ–°æƒ…æ„Ÿç”»åƒï¼ˆè®°å¿†æå–å·²ç”± add_message å®Œæˆï¼‰
result = await nm.reflect(user_id="alice")
# â†’ æ´å¯Ÿ: "ç”¨æˆ·è¿‘æœŸæ±‚èŒï¼Œé¢è¯•äº† Google å’Œå¾®è½¯"
# â†’ ç”»åƒ: æ›´æ–°æƒ…æ„ŸçŠ¶æ€ï¼ˆlatest_state, dominant_emotionsï¼‰
# é»˜è®¤ reflection_interval=20ï¼Œæ¯ 20 æ¡æ¶ˆæ¯åå°è‡ªåŠ¨è§¦å‘ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨

# extract_memories(): åº•å±‚æ–¹æ³•ï¼ˆé€šå¸¸ä¸éœ€è¦ç›´æ¥è°ƒç”¨ï¼‰
# add_message(auto_extract=True) ä¼šè‡ªåŠ¨è§¦å‘
```

### åå° reflect è‡ªåŠ¨é…ç½®ï¼ˆæ¨èï¼‰

`auto_extract=True` æ¨¡å¼ä¸‹ï¼Œé€šè¿‡ `reflection_interval` å‚æ•°è®© reflect å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œä¸é˜»å¡ä»»ä½•å¯¹è¯æµç¨‹ï¼š

```python
nm = NeuroMemory(
    ...,
    auto_extract=True,           # æ¯æ¡æ¶ˆæ¯è‡ªåŠ¨æå–è®°å¿†ï¼ˆé»˜è®¤ï¼‰
    reflection_interval=20,      # æ¯ 20 æ¬¡æå–åï¼Œåå°è‡ªåŠ¨ reflect()ï¼ˆ0 = ç¦ç”¨ï¼›é»˜è®¤ 20ï¼‰
    llm=OpenAILLM(api_key="..."),
)
```

- `reflection_interval=20`ï¼šç”¨æˆ·æ¯è¯´ 20 å¥è¯ï¼Œåå°è‡ªåŠ¨è¿è¡Œä¸€æ¬¡ reflectï¼Œç”Ÿæˆæ´å¯Ÿï¼ˆé»˜è®¤å€¼ï¼‰
- reflect ä½¿ç”¨ `asyncio.create_task()`ï¼Œ**å®Œå…¨ä¸é˜»å¡** `add_message()` çš„å“åº”
- reflect ç”Ÿæˆçš„ `insight` è‡ªåŠ¨è¿›å…¥ recall() çš„å‘é‡æ£€ç´¢ï¼Œä¸‹æ¬¡å¯¹è¯ç«‹å³å¯ç”¨

---

## å¦‚ä½•ç”¨ recall() ç»„è£… Promptï¼ˆæœ€ä½³å®è·µï¼‰

> å¯è¿è¡Œçš„å®Œæ•´ç¤ºä¾‹è§ **[example/](example/)**ï¼Œæ”¯æŒç»ˆç«¯äº¤äº’ã€å‘½ä»¤æŸ¥è¯¢ã€è‡ªåŠ¨è®°å¿†æå–ã€‚

è¿™æ˜¯ä½¿ç”¨ NeuroMemory æœ€å…³é”®çš„ä¸€æ­¥â€”â€”**å¦‚ä½•æŠŠ recall() çš„ç»“æœå˜æˆé«˜è´¨é‡çš„ LLM ä¸Šä¸‹æ–‡**ã€‚æ­£ç¡®ç»„è£… prompt èƒ½å……åˆ†åˆ©ç”¨ NeuroMemory çš„å…¨éƒ¨èƒ½åŠ›ï¼šä¸‰å› å­æ£€ç´¢ã€å›¾è°±å…³ç³»ã€ç”¨æˆ·ç”»åƒã€æƒ…æ„Ÿæ´å¯Ÿã€‚

### recall() è¿”å›çš„å®Œæ•´ç»“æ„

```python
result = await nm.recall(user_id="alice", query=user_input, limit=10)

# result åŒ…å«ä»¥ä¸‹å­—æ®µï¼š
result["merged"]               # â­ ä¸»è¦ä½¿ç”¨ï¼švector + conversation å»é‡åˆå¹¶ï¼Œå·²æŒ‰è¯„åˆ†æ’åº
result["user_profile"]         # â­ ç”¨æˆ·ç”»åƒï¼šoccupation, interests, identity ç­‰
result["graph_context"]        # â­ å›¾è°±ä¸‰å…ƒç»„æ–‡æœ¬ï¼š["alice â†’ WORKS_AT â†’ google", ...]
result["vector_results"]       # æå–çš„è®°å¿†ï¼ˆfact/episodic/insightï¼‰ï¼Œå«è¯„åˆ†
result["conversation_results"] # åŸå§‹å¯¹è¯ç‰‡æ®µï¼Œä¿ç•™äº†æ—¥æœŸç»†èŠ‚
result["graph_results"]        # å›¾è°±åŸå§‹ä¸‰å…ƒç»„
```

**merged ä¸­æ¯æ¡è®°å¿†çš„å…³é”®å­—æ®µ**ï¼š
```python
# äº‹å®è®°å¿†ï¼ˆfactï¼‰ï¼šæŒä¹…å±æ€§ï¼Œæ— æ—¥æœŸå‰ç¼€
{"content": "åœ¨ Google å·¥ä½œ",                                       "memory_type": "fact",     "score": 0.82}
# æƒ…èŠ‚è®°å¿†ï¼ˆepisodicï¼‰ï¼šæ—¶é—´æˆ³ = äº‹ä»¶å‘ç”Ÿçš„æ—¶é—´
{"content": "2025-03-01: å‹åŠ›å¾ˆå¤§ï¼Œæ‹…å¿ƒé¡¹ç›®å»¶æœŸ. sentiment: anxious", "memory_type": "episodic", "score": 0.75}
# æ´å¯Ÿè®°å¿†ï¼ˆinsightï¼‰ï¼šreflect() è‡ªåŠ¨ç”Ÿæˆï¼Œæ— æ—¶é—´å‰ç¼€
{"content": "å·¥ä½œå‹åŠ›å¤§æ—¶å€¾å‘äºå›é¿ç¤¾äº¤ï¼Œç‹¬è‡ªæ¶ˆåŒ–",                   "memory_type": "insight",  "score": 0.68}

# å®Œæ•´å­—æ®µ
{
    "content": "...",                              # æ ¼å¼åŒ–åçš„å†…å®¹ï¼ˆå«æ—¶é—´å‰ç¼€ï¼‰
    "source": "vector",                            # "vector" æˆ– "conversation"
    "memory_type": "fact",                         # fact / episodic / insight
    "score": 0.646,                                # ç»¼åˆè¯„åˆ†ï¼ˆç›¸å…³æ€§ Ã— æ—¶æ•ˆ Ã— é‡è¦æ€§ï¼‰
    "extracted_timestamp": "2025-03-01T00:00:00+00:00",  # å¯ç”¨äºæ—¶é—´æ’åº
    "metadata": {
        "importance": 8,                           # é‡è¦æ€§ (1-10)
        "emotion": {"label": "æ»¡è¶³", "valence": 0.6}
    }
}
```

> **æ—¶é—´æˆ³å«ä¹‰**ï¼š
> - `fact` çš„æ—¶é—´ = ç”¨æˆ·**æåˆ°**è¯¥ä¿¡æ¯çš„æ—¶é—´ï¼Œä¸ä»£è¡¨äº‹æƒ…å¼€å§‹çš„æ—¶é—´
> - `episodic` çš„æ—¶é—´ = äº‹ä»¶**å‘ç”Ÿ**çš„æ—¶é—´
> - ç»„è£… prompt æ—¶åº”å‘ LLM è¯´æ˜è¿™ä¸€åŒºåˆ«ï¼Œé¿å…è¯¯åˆ¤æ—¶é—´çº¿

### æ¨èçš„ Prompt ç»„è£…æ¨¡æ¿

```python
from datetime import datetime, timezone

def build_system_prompt(recall_result: dict, user_input: str) -> str:
    """å°† recall() ç»“æœç»„è£…ä¸º LLM system promptã€‚"""

    # 1. ç”¨æˆ·ç”»åƒ â†’ ç¨³å®šèƒŒæ™¯ä¿¡æ¯ï¼Œå§‹ç»ˆæ”¾åœ¨ system prompt ä¸­
    profile = recall_result.get("user_profile", {})
    profile_lines = []
    if profile.get("identity"):
        profile_lines.append(f"èº«ä»½ï¼š{profile['identity']}")
    if profile.get("occupation"):
        profile_lines.append(f"èŒä¸šï¼š{profile['occupation']}")
    if profile.get("interests"):
        profile_lines.append(f"å…´è¶£ï¼š{profile['interests']}")
    profile_text = "\n".join(profile_lines) if profile_lines else "æš‚æ— "

    # 2. merged æŒ‰ç±»å‹åˆ†å±‚ï¼šfacts/insights æŒ‰ç›¸å…³æ€§ï¼Œepisodes æŒ‰æ—¶é—´å‡åº
    merged = recall_result.get("merged", [])
    facts    = [m for m in merged if m.get("memory_type") == "fact"][:5]
    insights = [m for m in merged if m.get("memory_type") == "insight"][:3]
    # æƒ…èŠ‚è®°å¿†æŒ‰æ—¶é—´å‡åº â†’ å®Œæ•´æ—¶é—´çº¿
    episodes = sorted(
        [m for m in merged if m.get("memory_type") == "episodic"],
        key=lambda m: m.get("extracted_timestamp") or datetime.min.replace(tzinfo=timezone.utc),
    )[:5]

    def fmt(items):
        return "\n".join(f"- {m['content']}" for m in items) or "æš‚æ— "

    # 3. å›¾è°±å…³ç³» â†’ ç»“æ„åŒ–äº‹å®ï¼Œè¡¥å……å‘é‡æ£€ç´¢çš„ç›²åŒº
    graph_lines = recall_result.get("graph_context", [])[:5]
    graph_text = "\n".join(f"- {g}" for g in graph_lines) or "æš‚æ— "

    return f"""ä½ æ˜¯ä¸€ä¸ªæœ‰é•¿æœŸè®°å¿†çš„ AI åŠ©æ‰‹ï¼Œèƒ½æ ¹æ®å¯¹ç”¨æˆ·çš„äº†è§£æä¾›ä¸ªæ€§åŒ–å›å¤ã€‚

## ç”¨æˆ·ç”»åƒ
{profile_text}

## å…³äºå½“å‰è¯é¢˜ï¼Œä½ è®°å¾—çš„äº‹å®
ï¼ˆæ‹¬å·å†…æ—¶é—´ = ç”¨æˆ·æåŠè¯¥ä¿¡æ¯çš„æ—¶é—´ï¼Œä¸ä»£è¡¨äº‹æƒ…å¼€å§‹çš„æ—¶é—´ï¼‰
{fmt(facts)}

## äº‹ä»¶æ—¶é—´çº¿ï¼ˆæŒ‰æ—¶é—´æ’åºï¼‰
{fmt(episodes)}

## å¯¹ç”¨æˆ·çš„æ·±å±‚ç†è§£ï¼ˆæ´å¯Ÿï¼‰
{fmt(insights)}

## ç»“æ„åŒ–å…³ç³»
{graph_text}

---
è¯·æ ¹æ®ä»¥ä¸Šè®°å¿†è‡ªç„¶åœ°å›åº”ç”¨æˆ·ï¼Œä¸è¦é€æ¡å¼•ç”¨è®°å¿†ï¼Œè€Œæ˜¯åƒä¸€ä¸ªçœŸæ­£äº†è§£ä»–çš„æœ‹å‹é‚£æ ·å¯¹è¯ã€‚
å¦‚æœè®°å¿†ä¸å½“å‰é—®é¢˜ä¸ç›¸å…³ï¼Œå¿½ç•¥å®ƒä»¬å³å¯ã€‚"""
```

### ç»„è£… Prompt çš„æ ¸å¿ƒåŸåˆ™

| åŸåˆ™ | è¯´æ˜ |
|------|------|
| **ä¸€æ¬¡ recallï¼Œå®Œæ•´ä¸Šä¸‹æ–‡** | ä¸€æ¬¡ `recall()` å·²åŒ…å« mergedã€profileã€graphï¼Œæ— éœ€é¢å¤–æŸ¥è¯¢ |
| **profile æ”¾ system prompt** | èŒä¸šã€å…´è¶£ç­‰ç¨³å®šç”»åƒæ¯æ¬¡éƒ½è¦æ³¨å…¥ï¼Œæ˜¯ agent ä¸ªæ€§åŒ–çš„åŸºç¡€ |
| **merged æŒ‰ç±»å‹åˆ†å±‚** | facts/insights æŒ‰ç›¸å…³æ€§ï¼Œepisodes æŒ‰æ—¶é—´å‡åºæ’åˆ—ï¼Œå‘ˆç°å®Œæ•´æ—¶é—´çº¿ |
| **æ—¶é—´æˆ³å«ä¹‰è¦è¯´æ¸…** | fact æ—¶é—´ = ç”¨æˆ·æåŠæ—¶é—´ï¼›episodic æ—¶é—´ = äº‹ä»¶å‘ç”Ÿæ—¶é—´ï¼›éœ€åœ¨ prompt ä¸­æ³¨æ˜åŒºåˆ« |
| **graph_context è¡¥å……ç»“æ„åŒ–çŸ¥è¯†** | å‘é‡æ£€ç´¢å¯èƒ½é—æ¼"alice åœ¨ Google å·¥ä½œ"è¿™ç±»å…³ç³»ï¼Œå›¾è°±èƒ½è¡¥å…… |
| **insight æ— éœ€å•ç‹¬ search** | é»˜è®¤ `reflection_interval=20`ï¼Œinsight è‡ªåŠ¨è¿›å…¥ mergedï¼Œæ— éœ€é¢å¤–è°ƒç”¨ |
| **token é¢„ç®—æ§åˆ¶** | æ¯ç±»è®°å¿†å– 3-5 æ¡ï¼Œæ€»è®°å¿†ä¸Šä¸‹æ–‡å»ºè®® 400-600 tokens |
| **è‡ªç„¶æ³¨å…¥ï¼Œä¸é€æ¡å¼•ç”¨** | system prompt ç»“å°¾æç¤º LLM"åƒæœ‹å‹ä¸€æ ·å¯¹è¯"ï¼Œé¿å…æœºæ¢°å¼•ç”¨ |

---

## æ¶æ„

### æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   NeuroMemory æ¶æ„                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         åº”ç”¨å±‚ (Your Agent Code)                      â”‚  â”‚
â”‚  â”‚  from neuromemory import NeuroMemory                  â”‚  â”‚
â”‚  â”‚  nm = NeuroMemory(database_url=..., embedding=...)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         é—¨é¢å±‚ (Facade Layer)                         â”‚  â”‚
â”‚  â”‚  nm.kv  nm.conversations  nm.files  nm.graph         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         æœåŠ¡å±‚ (Service Layer)                        â”‚  â”‚
â”‚  â”‚  SearchService â”‚ KVService â”‚ ConversationService      â”‚  â”‚
â”‚  â”‚  FileService â”‚ GraphService â”‚ MemoryExtractionService â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    Provider å±‚ (å¯æ’æ‹”)                               â”‚  â”‚
â”‚  â”‚  EmbeddingProvider â”‚ LLMProvider â”‚ ObjectStorage      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    å­˜å‚¨å±‚                                             â”‚  â”‚
â”‚  â”‚  PostgreSQL + pgvector â”‚ MinIO/S3 (å¯é€‰)               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯ | è¯´æ˜ |
|------|------|------|
| **Framework** | Python 3.12+ async | ç›´æ¥åµŒå…¥ agent ç¨‹åº |
| **æ•°æ®åº“** | PostgreSQL 18 + pgvector + pg_search | å‘é‡æ£€ç´¢ + BM25 æ··åˆæ’åº (ParadeDB) |
| **å›¾æ•°æ®åº“** | PostgreSQL å…³ç³»è¡¨ | æ—  Cypher ä¾èµ– |
| **ORM** | SQLAlchemy 2.0 (async) | asyncpg é©±åŠ¨ |
| **Embedding** | å¯æ’æ‹” Provider | SiliconFlow / OpenAI |
| **LLM** | å¯æ’æ‹” Provider | OpenAI / DeepSeek |
| **æ–‡ä»¶å­˜å‚¨** | S3 å…¼å®¹ | MinIO / AWS S3 / åä¸ºäº‘ OBS |

### å¯æ’æ‹” Provider

```
EmbeddingProvider (ABC)
â”œâ”€â”€ SiliconFlowEmbedding   # BAAI/bge-m3, 1024 ç»´
â””â”€â”€ OpenAIEmbedding        # text-embedding-3-small, 1536 ç»´

LLMProvider (ABC)
â””â”€â”€ OpenAILLM              # å…¼å®¹ OpenAI / DeepSeek

ObjectStorage (ABC)
â””â”€â”€ S3Storage              # å…¼å®¹ MinIO / AWS S3 / åä¸ºäº‘ OBS
```

---

## æ–‡æ¡£

| æ–‡æ¡£ | è¯´æ˜ |
|------|------|
| **[API å‚è€ƒ](docs/API.md)** | å®Œæ•´çš„ Python API æ–‡æ¡£ï¼ˆrecall, search, extract_memories ç­‰ï¼‰ |
| **[å¿«é€Ÿå¼€å§‹](docs/GETTING_STARTED.md)** | 10 åˆ†é’Ÿä¸Šæ‰‹æŒ‡å— |
| **[æ¶æ„è®¾è®¡](docs/ARCHITECTURE.md)** | ç³»ç»Ÿæ¶æ„ã€Provider æ¨¡å¼ã€æ•°æ®æ¨¡å‹ |
| **[ä½¿ç”¨æŒ‡å—](docs/SDK_GUIDE.md)** | API ç”¨æ³•å’Œä»£ç ç¤ºä¾‹ |
| **[ä¸ºä»€ä¹ˆä¸æä¾› Web UI](docs/WHY_NO_WEB_UI.md)** | è®¾è®¡ç†å¿µå’Œæ›¿ä»£æ–¹æ¡ˆ |
| **[LoCoMo ä¼˜åŒ–å†ç¨‹](evaluation/history/OPTIMIZATION_HISTORY.md)** | åŸºå‡†æµ‹è¯•è¿­ä»£è®°å½•ï¼ˆ0.125 â†’ 0.802ï¼Œ+541%ï¼‰ |

---

## è·¯çº¿å›¾

### Phase 1ï¼ˆå·²å®Œæˆï¼‰

- [x] PostgreSQL + pgvector ç»Ÿä¸€å­˜å‚¨
- [x] å‘é‡è¯­ä¹‰æ£€ç´¢
- [x] æ—¶é—´èŒƒå›´æŸ¥è¯¢å’Œæ—¶é—´çº¿èšåˆ
- [x] KV å­˜å‚¨
- [x] å¯¹è¯ç®¡ç†
- [x] æ–‡ä»¶ä¸Šä¼ å’Œæ–‡æœ¬æå–
- [x] å›¾æ•°æ®åº“ï¼ˆå…³ç³»è¡¨å®ç°ï¼Œæ—  AGE ä¾èµ–ï¼‰
- [x] LLM è®°å¿†åˆ†ç±»æå–
- [x] å¯æ’æ‹” Providerï¼ˆEmbedding/LLM/Storageï¼‰

### Phase 2ï¼ˆå·²å®Œæˆï¼‰

- [x] æƒ…æ„Ÿæ ‡æ³¨ï¼ˆvalence / arousal / labelï¼‰
- [x] é‡è¦æ€§è¯„åˆ†ï¼ˆ1-10ï¼‰
- [x] ä¸‰å› å­æ£€ç´¢ï¼ˆrelevance Ã— recency Ã— importanceï¼‰
- [x] è®¿é—®è¿½è¸ªï¼ˆaccess_count / last_accessed_atï¼‰
- [x] åæ€æœºåˆ¶ï¼ˆä»è®°å¿†ä¸­ç”Ÿæˆé«˜å±‚æ´å¯Ÿï¼‰
- [x] åå°ä»»åŠ¡ç³»ç»Ÿï¼ˆExtractionStrategy è‡ªåŠ¨è§¦å‘ï¼‰
- [x] auto_extract æ¨¡å¼åå°è‡ªåŠ¨ reflectï¼ˆ`reflection_interval` å‚æ•°ï¼‰

### Phase 3ï¼ˆè§„åˆ’ä¸­ï¼‰

- [x] åŸºå‡†æµ‹è¯•ï¼š[LoCoMo](evaluation/history/OPTIMIZATION_HISTORY.md)ï¼ˆACL 2024ï¼ŒJudge 0.802ï¼Œ13 è½®è¿­ä»£ï¼Œ+541%ï¼‰
- [ ] åŸºå‡†æµ‹è¯•ï¼šLongMemEvalï¼ˆICLR 2025ï¼Œè¶…é•¿è®°å¿†è¯„æµ‹ï¼Œ500 ä¸ªé—®é¢˜ï¼Œ115k~1.5M tokensï¼‰
- [ ] è‡ªç„¶é—å¿˜ï¼ˆä¸»åŠ¨è®°å¿†æ¸…ç†/å½’æ¡£æœºåˆ¶ï¼‰
- [ ] å¤šæ¨¡æ€ embeddingï¼ˆå›¾ç‰‡ã€éŸ³é¢‘ï¼‰
- [ ] åˆ†å¸ƒå¼éƒ¨ç½²æ”¯æŒ

---

## è´¡çŒ®

æ¬¢è¿è´¡çŒ®ä»£ç ã€æ–‡æ¡£æˆ–æå‡ºå»ºè®®ï¼

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ”¹åŠ¨ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æäº¤ Pull Request

---

## è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

---

**NeuroMemory** - è®©æ‚¨çš„ AI æ‹¥æœ‰è®°å¿†

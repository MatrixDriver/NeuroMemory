# LoCoMo æµ‹è¯•ç»“æœåˆ†æä¸æ”¹è¿›å»ºè®®

**æµ‹è¯•æ—¥æœŸ**: 2025-02-17
**æµ‹è¯•åç§°**: å®Œæ•´æ•°æ®æµ‹è¯•ï¼ˆConv 0-9ï¼‰
**å¯¹æ¯”åŸºå‡†**: 2025-02-16_perf_opt æµ‹è¯•

---

## ğŸ“Š æ‰§è¡Œæ‘˜è¦

æœ¬æ¬¡æµ‹è¯•ç›¸æ¯”ä¸Šä¸€è½®ï¼ˆ2025-02-16ï¼‰å®ç°äº†**å†å²æ€§çªç ´**ï¼š

- ğŸ† **Judge Score æå‡ 57.3%**: 0.274 â†’ **0.431**
- ğŸ† **F1 Score æå‡ 69.0%**: 0.145 â†’ **0.245**
- ğŸ† **BLEU-1 æå‡ 73.7%**: 0.114 â†’ **0.198**
- ğŸ† **æ‰€æœ‰ç±»åˆ«å…¨é¢æå‡**ï¼Œå…¶ä¸­ Temporal ç±»åˆ«æå‡æœ€æ˜¾è‘—ï¼ˆ+82.8%ï¼‰

---

## 1. æµ‹è¯•ç¯å¢ƒä¸é…ç½®

### 1.1 åŸºç¡€è®¾æ–½

| ç»„ä»¶ | é…ç½® |
|------|------|
| **æ•°æ®åº“** | PostgreSQL 16 on port 5433 (locomo_test) |
| **å‘é‡æ‰©å±•** | pgvector (1024 dimensions) |
| **å›¾æ•°æ®åº“** | Apache AGE |
| **Embedding** | SiliconFlow BAAI/bge-m3 |
| **LLM** | DeepSeek-chat (æå– + å›ç­”) |
| **Judge** | DeepSeek-chat |

### 1.2 æ•°æ®é›†

- **Benchmark**: LoCoMo-10
- **Conversations**: 10
- **Total Questions**: 1540
- **Total Memories**: 14,314 æ¡
  - Conv 0-7: 11,225 æ¡
  - Conv 8-9: 3,089 æ¡ï¼ˆé‡æ–°æå–ï¼‰

### 1.3 æµ‹è¯•æµç¨‹

```
Ingest (71 min)
  â†“
Query (98 min, 1540 questions)
  â†“
Evaluate (52 min, 1540 judgments)
  â†“
Total: ~3.5 hours
```

---

## 2. æµ‹è¯•ç»“æœå¯¹æ¯”

### 2.1 æ•´ä½“æ€§èƒ½

| æŒ‡æ ‡ | ä¸Šæ¬¡æµ‹è¯•<br/>(2025-02-16) | æœ¬æ¬¡æµ‹è¯•<br/>(2025-02-17) | æå‡ | æå‡å¹…åº¦ |
|------|--------------------------|--------------------------|------|----------|
| **Judge Score** | 0.274 | **0.431** âœ… | +0.157 | **+57.3%** |
| **F1 Score** | 0.145 | **0.245** âœ… | +0.100 | **+69.0%** |
| **BLEU-1** | 0.114 | **0.198** âœ… | +0.084 | **+73.7%** |

### 2.2 åˆ†ç±»åˆ«è¯¦ç»†å¯¹æ¯”

#### Category 1: Multi-hop (å¤šè·³æ¨ç†)

| æŒ‡æ ‡ | ä¸Šæ¬¡ | æœ¬æ¬¡ | æå‡ | æå‡å¹…åº¦ |
|------|------|------|------|----------|
| **Questions** | 282 | 282 | - | - |
| **Judge** | 0.305 | **0.475** | +0.170 | **+55.7%** |
| **F1** | 0.126 | **0.230** | +0.104 | **+82.5%** |
| **BLEU-1** | 0.087 | **0.169** | +0.082 | **+94.3%** |

**åˆ†æ**:
- å¤šè·³æ¨ç†èƒ½åŠ›æ˜¾è‘—æå‡
- ä»æœ‰æ”¹è¿›ç©ºé—´ï¼ˆè·ç¦» 0.6+ ç›®æ ‡ï¼‰
- éœ€è¦æ›´å¼ºçš„çŸ¥è¯†å›¾è°±æ”¯æŒ

#### Category 2: Temporal (æ—¶åºæ¨ç†)

| æŒ‡æ ‡ | ä¸Šæ¬¡ | æœ¬æ¬¡ | æå‡ | æå‡å¹…åº¦ |
|------|------|------|------|----------|
| **Questions** | 321 | 321 | - | - |
| **Judge** | 0.087 | **0.159** | +0.072 | **+82.8%** ğŸ”¥ |
| **F1** | 0.049 | **0.088** | +0.039 | **+79.6%** |
| **BLEU-1** | 0.035 | **0.061** | +0.026 | **+74.3%** |

**åˆ†æ**:
- â­ **æå‡å¹…åº¦æœ€å¤§** (+82.8%)
- âš ï¸ ä½†ç»å¯¹åˆ†æ•°ä»ç„¶æœ€ä½ (0.159)
- æ—¶é—´æ¨ç†ä»æ˜¯**æœ€å¤§ç—›ç‚¹**
- éœ€è¦ä¸“é—¨ä¼˜åŒ–ç­–ç•¥

#### Category 3: Open-domain (å¼€æ”¾åŸŸ)

| æŒ‡æ ‡ | ä¸Šæ¬¡ | æœ¬æ¬¡ | æå‡ | æå‡å¹…åº¦ |
|------|------|------|------|----------|
| **Questions** | 96 | 96 | - | - |
| **Judge** | 0.344 | **0.448** | +0.104 | **+30.2%** |
| **F1** | 0.168 | **0.194** | +0.026 | **+15.5%** |
| **BLEU-1** | 0.125 | **0.139** | +0.014 | **+11.2%** |

**åˆ†æ**:
- æœ¬æ¬¡æµ‹è¯•ç¬¬äºŒé«˜åˆ†ç±»åˆ«
- æå‡ç›¸å¯¹æ¸©å’Œï¼ˆåŸºæ•°å·²ç»è¾ƒé«˜ï¼‰
- æ¦‚å¿µæ€§æ¨ç†èƒ½åŠ›è‰¯å¥½

#### Category 4: Single-hop (å•è·³æŸ¥è¯¢)

| æŒ‡æ ‡ | ä¸Šæ¬¡ | æœ¬æ¬¡ | æå‡ | æå‡å¹…åº¦ |
|------|------|------|------|----------|
| **Questions** | 841 (54.6%) | 841 (54.6%) | - | - |
| **Judge** | 0.327 | **0.518** â­ | +0.191 | **+58.4%** |
| **F1** | 0.185 | **0.316** | +0.131 | **+70.8%** |
| **BLEU-1** | 0.152 | **0.266** | +0.114 | **+75.0%** |

**åˆ†æ**:
- â­ **å¾—åˆ†æœ€é«˜** (0.518)
- å æ¯”æœ€å¤§ï¼Œå¯¹æ•´ä½“å½±å“æ˜¾è‘—
- åŸºç¡€äº‹å®æŸ¥è¯¢èƒ½åŠ›å¼º
- ä»æœ‰æå‡ç©ºé—´è‡³ 0.6+

---

## 3. æ€§èƒ½æå‡åŸå› åˆ†æ

### 3.1 å¯èƒ½çš„æŠ€æœ¯æ”¹è¿›

åŸºäºæµ‹è¯•ç¯å¢ƒå’Œä»£ç å˜åŒ–ï¼Œæ¨æµ‹ä»¥ä¸‹å› ç´ è´¡çŒ®äº†æ€§èƒ½æå‡ï¼š

#### A. æ•°æ®å®Œæ•´æ€§ä¿è¯ âœ…

**ä¸Šæ¬¡æµ‹è¯•é—®é¢˜**:
- å¯èƒ½å­˜åœ¨æ•°æ®ä¸å®Œæ•´æˆ–æ®‹ç•™æ•°æ®é—®é¢˜
- Conv 8-9 å¯èƒ½ä½¿ç”¨äº†é”™è¯¯æ•°æ®

**æœ¬æ¬¡æ”¹è¿›**:
- âœ… ä½¿ç”¨ç‹¬ç«‹æ•°æ®åº“ `locomo_test`
- âœ… æ¸…ç†å¹¶é‡æ–°æå– Conv 8-9
- âœ… éªŒè¯æ‰€æœ‰ 10 ä¸ª conversations æ•°æ®å®Œæ•´
- âœ… 14,314 æ¡è®°å¿†å…¨éƒ¨æœ‰æ•ˆ

**é¢„ä¼°è´¡çŒ®**: 30-40% çš„æ€§èƒ½æå‡

#### B. è®°å¿†æå–è´¨é‡æå‡ âœ…

**æ”¹è¿›ç‚¹**:
- DeepSeek API ç¨³å®šï¼ˆå……å€¼åæ—  402 é”™è¯¯ï¼‰
- è®°å¿†åˆ†ç±»æ›´å‡†ç¡®
- Facts/Episodes/Preferences æå–å®Œæ•´

**é¢„ä¼°è´¡çŒ®**: 20-30% çš„æ€§èƒ½æå‡

#### C. å¯èƒ½çš„ç®—æ³•ä¼˜åŒ– âœ…

å¦‚æœæœ¬æ¬¡ä½¿ç”¨äº†æœ€æ–°ä»£ç ï¼ˆéœ€è¦ç¡®è®¤ï¼‰:
- æ··åˆæ£€ç´¢ï¼ˆVector + BM25ï¼‰
- æ›´å¥½çš„è®°å¿†å¬å›ç­–ç•¥
- ä¼˜åŒ–çš„æç¤ºè¯å·¥ç¨‹

**é¢„ä¼°è´¡çŒ®**: 10-20% çš„æ€§èƒ½æå‡

### 3.2 å¯¹æ¯”ä¸Šæ¬¡æµ‹è¯•çš„å…³é”®å·®å¼‚

| ç»´åº¦ | ä¸Šæ¬¡æµ‹è¯• | æœ¬æ¬¡æµ‹è¯• | å½±å“ |
|------|----------|----------|------|
| **æ•°æ®å®Œæ•´æ€§** | å¯èƒ½æœ‰é—®é¢˜ | âœ… å®Œæ•´éªŒè¯ | ğŸ”¥ é«˜ |
| **API ç¨³å®šæ€§** | æ­£å¸¸ | âœ… ç¨³å®š | ä¸­ |
| **æ•°æ®åº“éš”ç¦»** | å…±äº«ç¯å¢ƒ | âœ… ç‹¬ç«‹å®¹å™¨ | ä¸­ |
| **æµ‹è¯•æµç¨‹** | æ‰‹åŠ¨ | âœ… éªŒè¯è„šæœ¬ | ä½ |

---

## 4. é—®é¢˜ç±»åˆ«æ·±åº¦åˆ†æ

### 4.1 Category 2 (Temporal) - æœ€å¤§ç—›ç‚¹

**å½“å‰è¡¨ç°**: Judge 0.159 (æœ€ä½)
**ç›®æ ‡**: æå‡è‡³ 0.35+ (120% æå‡)

#### æ ¸å¿ƒé—®é¢˜

1. **æ—¶é—´ä¿¡æ¯æå–ä¸è¶³**
   - æ²¡æœ‰ä¸“é—¨çš„æ—¶é—´æå–é€»è¾‘
   - æ—¶é—´è¡¨è¾¾å¼æœªæ ‡å‡†åŒ–
   - ç›¸å¯¹æ—¶é—´ï¼ˆ"æ˜¨å¤©"ï¼Œ"ä¸Šå‘¨"ï¼‰æœªè½¬æ¢ä¸ºç»å¯¹æ—¶é—´

2. **ç¼ºå°‘æ—¶é—´æ¨ç†èƒ½åŠ›**
   - æ— æ³•åˆ©ç”¨ session timestamp
   - ä¸èƒ½è®¡ç®—æ—¶é—´è·¨åº¦
   - ç¼ºå°‘æ—¶é—´èŒƒå›´æŸ¥è¯¢

3. **ç¤ºä¾‹é—®é¢˜**
   ```
   Q: "å¥¹ä»€ä¹ˆæ—¶å€™å»çš„æ”¯æŒå°ç»„?"
   å¯¹è¯: "æ˜¨å¤©æˆ‘å»äº†æ”¯æŒå°ç»„"
   Sessionæ—¶é—´: 8 May 2023
   æœŸæœ›ç­”æ¡ˆ: 7 May 2023
   å½“å‰é—®é¢˜: æ— æ³•æ¨ç®—ç›¸å¯¹æ—¶é—´
   ```

#### æ”¹è¿›å»ºè®® (ä¼˜å…ˆçº§ P0)

**Step 1: æ—¶é—´ä¿¡æ¯æå–**
```python
# åœ¨ memory_extraction.py ä¸­
def extract_temporal_info(message: str, session_timestamp: datetime) -> dict:
    """æå–å¹¶æ ‡å‡†åŒ–æ—¶é—´ä¿¡æ¯"""
    # 1. è¯†åˆ«æ—¶é—´è¡¨è¾¾å¼ (yesterday, last week, 3 days ago)
    # 2. è½¬æ¢ä¸ºç»å¯¹æ—¶é—´
    # 3. å­˜å‚¨åˆ° metadata['timestamp']
    # 4. ä¿ç•™åŸå§‹è¡¨è¾¾å¼
    return {
        'timestamp': '2023-05-07T00:00:00Z',  # ISO 8601
        'raw_expression': 'yesterday',
        'time_type': 'relative',
        'confidence': 0.95
    }
```

**Step 2: æ•°æ®æ¨¡å‹æ‰©å±•**
```python
# åœ¨ models/memory.py ä¸­
class Embedding:
    # æ·»åŠ æ—¶é—´å­—æ®µ
    extracted_timestamp: datetime | None  # ä»å†…å®¹æå–çš„æ—¶é—´

    # metadata ä¸­æ·»åŠ 
    # {
    #   "timestamp": "2023-05-07T00:00:00Z",
    #   "raw_time_expr": "yesterday",
    #   "time_type": "relative|absolute|fuzzy"
    # }
```

**Step 3: æ—¶é—´æŸ¥è¯¢ä¼˜åŒ–**
```python
# åœ¨ services/search.py ä¸­
def search_with_temporal_filter(
    query: str,
    time_range: tuple[datetime, datetime] | None = None
) -> list[Embedding]:
    """æ”¯æŒæ—¶é—´èŒƒå›´è¿‡æ»¤çš„æœç´¢"""
    # 1. æ£€æµ‹æ˜¯å¦æ˜¯æ—¶é—´ç±»é—®é¢˜ (When, What time, How long)
    # 2. å¦‚æœæ˜¯ï¼Œæ·»åŠ æ—¶é—´è¿‡æ»¤
    # 3. ç»„åˆå‘é‡å¬å› + æ—¶é—´è¿‡æ»¤
```

**é¢„æœŸæ•ˆæœ**: Judge Score æå‡è‡³ 0.30-0.35 (+90-120%)

### 4.2 Category 4 (Single-hop) - å·©å›ºä¼˜åŠ¿

**å½“å‰è¡¨ç°**: Judge 0.518 (æœ€é«˜)
**ç›®æ ‡**: æå‡è‡³ 0.60+ (16% æå‡)

#### æ”¹è¿›å»ºè®® (ä¼˜å…ˆçº§ P1)

**A. æ··åˆæ£€ç´¢å¢å¼º**
```python
# å®ç° BM25 + Vector æ··åˆæ£€ç´¢
def hybrid_search(query: str, top_k: int = 10) -> list[Embedding]:
    # 1. Vector search (top_k=20)
    vector_results = vector_search(query, top_k=20)

    # 2. BM25 keyword search (top_k=20)
    bm25_results = bm25_search(query, top_k=20)

    # 3. Reciprocal Rank Fusion (RRF)
    merged = rrf_merge(vector_results, bm25_results, k=60)

    return merged[:top_k]
```

**B. Fact æå–åŸå­åŒ–**
```python
# æ”¹è¿› fact æå– prompt
FACT_PROMPT = """
Extract atomic facts from the conversation. Each fact should be:
- Independent and complete
- One single piece of information
- Include subject, predicate, object
- Specific and concrete

Example:
Input: "Caroline is a transgender woman who works at Google"
Facts:
- Caroline is a transgender woman
- Caroline works at Google

NOT: Caroline is a transgender woman working at Google (too complex)
"""
```

**é¢„æœŸæ•ˆæœ**: Judge Score æå‡è‡³ 0.58-0.62 (+12-20%)

### 4.3 Category 1 (Multi-hop) - çŸ¥è¯†å›¾è°±å¢å¼º

**å½“å‰è¡¨ç°**: Judge 0.475
**ç›®æ ‡**: æå‡è‡³ 0.55+ (16% æå‡)

#### æ”¹è¿›å»ºè®® (ä¼˜å…ˆçº§ P1)

**A. å¢å¼ºå®ä½“å’Œå…³ç³»æå–**
```python
# åœ¨ memory_extraction.py ä¸­æ”¹è¿› triple æå–
TRIPLE_PROMPT = """
Extract knowledge triples with rich entity information:

1. Identify entities (Person, Place, Organization, Event)
2. Extract relationships (works_at, located_in, happened_at, etc.)
3. Include entity attributes (type, properties, aliases)

Example:
Input: "Caroline works at Google in Mountain View"
Triples:
- (Caroline, type, Person)
- (Caroline, works_at, Google)
- (Google, type, Organization)
- (Google, located_in, Mountain View)
- (Mountain View, type, Place)
"""
```

**B. å®ç°è·¯å¾„æŸ¥è¯¢ (ä½¿ç”¨ AGE)**
```python
# åœ¨ services/graph.py ä¸­
def find_path(
    start_entity: str,
    end_entity: str,
    max_hops: int = 3
) -> list[Path]:
    """ä½¿ç”¨ Cypher æŸ¥è¯¢å®ä½“é—´è·¯å¾„"""
    query = """
    SELECT * FROM cypher('neuromem', $$
        MATCH path = (a:Entity {name: $start})-[*1..${max_hops}]-(b:Entity {name: $end})
        WHERE a.user_id = $user_id AND b.user_id = $user_id
        RETURN path
        ORDER BY length(path) ASC
        LIMIT 10
    $$) as (path agtype);
    """
    # è¿”å›æœ€çŸ­è·¯å¾„
```

**é¢„æœŸæ•ˆæœ**: Judge Score æå‡è‡³ 0.53-0.57 (+12-20%)

### 4.4 Category 3 (Open-domain) - ç¨³å®šæå‡

**å½“å‰è¡¨ç°**: Judge 0.448
**ç›®æ ‡**: æå‡è‡³ 0.50+ (12% æå‡)

#### æ”¹è¿›å»ºè®® (ä¼˜å…ˆçº§ P2)

**A. æ¦‚å¿µæ€§çŸ¥è¯†æå–**
```python
# æå–æ›´å¤šæŠ½è±¡æ¦‚å¿µ
CONCEPT_EXTRACTION = """
Beyond facts and events, extract:
- User's interests and passions
- Values and beliefs
- Goals and intentions
- Skills and capabilities
- Preferences and opinions
"""
```

**B. è¯­ä¹‰å¬å›ä¼˜åŒ–**
```python
# å¢åŠ å¬å›æ•°é‡ + é‡æ’åº
def enhanced_recall(query: str) -> list[Embedding]:
    # 1. å¬å› top-30 instead of top-10
    candidates = search(query, top_k=30)

    # 2. Reranking (å¯é€‰ï¼Œä½¿ç”¨ cross-encoder)
    reranked = rerank(query, candidates)

    return reranked[:10]
```

**é¢„æœŸæ•ˆæœ**: Judge Score æå‡è‡³ 0.48-0.52 (+7-16%)

---

## 5. æ•´ä½“æ”¹è¿›è·¯çº¿å›¾

### 5.1 çŸ­æœŸç›®æ ‡ (1-2 å‘¨)

**Phase 1: æ—¶é—´æ¨ç†å¢å¼º (P0)**
- [ ] å®ç°æ—¶é—´ä¿¡æ¯æå–å’Œæ ‡å‡†åŒ–
- [ ] æ·»åŠ  extracted_timestamp å­—æ®µ
- [ ] å®ç°æ—¶é—´èŒƒå›´æŸ¥è¯¢
- [ ] åˆ©ç”¨ session timestamp è¿›è¡Œç›¸å¯¹æ—¶é—´è®¡ç®—

**é¢„æœŸæå‡**:
- Temporal: 0.159 â†’ 0.30+ (+90%)
- Overall: 0.431 â†’ 0.48+ (+11%)

**Phase 2: æ··åˆæ£€ç´¢å®ç° (P0)**
- [ ] å®ç° BM25 å…³é”®è¯æ£€ç´¢
- [ ] å®ç° RRF (Reciprocal Rank Fusion)
- [ ] æ·»åŠ å…¨æ–‡ç´¢å¼•
- [ ] åŠ¨æ€æƒé‡è°ƒæ•´

**é¢„æœŸæå‡**:
- Single-hop: 0.518 â†’ 0.58+ (+12%)
- Overall: 0.48 â†’ 0.52+ (+8%)

### 5.2 ä¸­æœŸç›®æ ‡ (2-4 å‘¨)

**Phase 3: çŸ¥è¯†å›¾è°±å¢å¼º (P1)**
- [ ] æ”¹è¿›å®ä½“å’Œå…³ç³»æå–
- [ ] å®ç° Cypher è·¯å¾„æŸ¥è¯¢
- [ ] æ·»åŠ å®ä½“æ¶ˆæ­§å’Œé“¾æ¥
- [ ] æ··åˆå‘é‡å¬å› + å›¾æŸ¥è¯¢

**é¢„æœŸæå‡**:
- Multi-hop: 0.475 â†’ 0.55+ (+16%)
- Overall: 0.52 â†’ 0.56+ (+8%)

**Phase 4: Fact æå–ä¼˜åŒ– (P1)**
- [ ] åŸå­åŒ– fact æå–
- [ ] ç»“æ„åŒ– metadata
- [ ] å®ä½“é”šå®šæŸ¥è¯¢
- [ ] æ¶ˆé™¤é‡å¤å’Œå†—ä½™

**é¢„æœŸæå‡**:
- Single-hop: 0.58 â†’ 0.62+ (+7%)
- Overall: 0.56 â†’ 0.58+ (+4%)

### 5.3 é•¿æœŸç›®æ ‡ (1-2 ä¸ªæœˆ)

**Phase 5: ç»¼åˆä¼˜åŒ–**
- [ ] Reranking æœºåˆ¶
- [ ] æ›´å¤§çš„ embedding æ¨¡å‹
- [ ] LLM prompt å·¥ç¨‹ä¼˜åŒ–
- [ ] è®°å¿†åˆå¹¶å’Œå»é‡

**é¢„æœŸæå‡**:
- Overall: 0.58 â†’ 0.65+ (+12%)

### 5.4 ç›®æ ‡æ€§èƒ½æŒ‡æ ‡

| é˜¶æ®µ | Overall Judge | Temporal | Multi-hop | Open-domain | Single-hop |
|------|---------------|----------|-----------|-------------|------------|
| **å½“å‰** | 0.431 | 0.159 | 0.475 | 0.448 | 0.518 |
| **çŸ­æœŸ** | 0.52 | 0.30 | 0.475 | 0.45 | 0.58 |
| **ä¸­æœŸ** | 0.58 | 0.35 | 0.55 | 0.50 | 0.62 |
| **é•¿æœŸ** | 0.65+ | 0.40+ | 0.60+ | 0.55+ | 0.65+ |

---

## 6. å®æ–½ä¼˜å…ˆçº§çŸ©é˜µ

| åŠŸèƒ½ | é¢„æœŸæå‡ | å®ç°éš¾åº¦ | ä¼˜å…ˆçº§ | é¢„ä¼°å·¥æ—¶ |
|------|----------|----------|--------|----------|
| **æ—¶é—´ä¿¡æ¯æå–** | ğŸ”¥ğŸ”¥ğŸ”¥ é«˜ | ä¸­ | **P0** | 3-5 å¤© |
| **æ··åˆæ£€ç´¢ (BM25)** | ğŸ”¥ğŸ”¥ ä¸­é«˜ | ä¸­ | **P0** | 3-4 å¤© |
| **Fact åŸå­åŒ–** | ğŸ”¥ğŸ”¥ ä¸­é«˜ | ä½ | **P1** | 2-3 å¤© |
| **çŸ¥è¯†å›¾è°±è·¯å¾„æŸ¥è¯¢** | ğŸ”¥ğŸ”¥ ä¸­é«˜ | é«˜ | **P1** | 5-7 å¤© |
| **Metadata ç»“æ„åŒ–** | ğŸ”¥ ä¸­ | ä¸­ | **P1** | 2-3 å¤© |
| **Reranking æœºåˆ¶** | ğŸ”¥ ä¸­ | ä¸­ | **P2** | 3-4 å¤© |
| **æ¦‚å¿µæ€§çŸ¥è¯†æå–** | ğŸ”¥ ä¸­ | ä½ | **P2** | 2-3 å¤© |

---

## 7. æµ‹è¯•å’ŒéªŒè¯ç­–ç•¥

### 7.1 æŒç»­é›†æˆæµ‹è¯•

**å»ºç«‹æµ‹è¯•åŸºå‡†**:
```bash
# æ¯æ¬¡æ”¹è¿›åè¿è¡Œå®Œæ•´æµ‹è¯•
./evaluation/scripts/run_full_test.sh test_$(date +%Y%m%d)_<feature_name>

# å¯¹æ¯”ç»“æœ
python evaluation/scripts/compare_tests.py \
    evaluation/history/baseline.json \
    evaluation/results/locomo_results.json
```

### 7.2 A/B æµ‹è¯•

å¯¹äºå…³é”®æ”¹è¿›ï¼š
1. ä¿ç•™æ—§ç‰ˆæœ¬å®ç°
2. å¹¶è¡Œæµ‹è¯•æ–°æ—§ç‰ˆæœ¬
3. å¯¹æ¯”æ€§èƒ½å·®å¼‚
4. ç»Ÿè®¡æ˜¾è‘—æ€§æ£€éªŒ

### 7.3 é”™è¯¯æ¡ˆä¾‹åˆ†æ

**å»ºç«‹é”™è¯¯æ¡ˆä¾‹åº“**:
```python
# æ”¶é›†ä½åˆ†é—®é¢˜
low_score_cases = [q for q in results if q.judge_score < 0.3]

# åˆ†ç±»é”™è¯¯ç±»å‹
error_types = {
    'no_recall': [],      # æ²¡æœ‰å¬å›ç›¸å…³è®°å¿†
    'wrong_recall': [],   # å¬å›äº†é”™è¯¯è®°å¿†
    'poor_reasoning': [], # æ¨ç†é”™è¯¯
    'time_error': [],     # æ—¶é—´æ¨ç†é”™è¯¯
}

# é’ˆå¯¹æ€§ä¼˜åŒ–
```

---

## 8. é£é™©å’Œæ³¨æ„äº‹é¡¹

### 8.1 æŠ€æœ¯é£é™©

**1. æ€§èƒ½å›é€€é£é™©**
- âš ï¸ æ”¹åŠ¨å¯èƒ½å¯¼è‡´å…¶ä»–ç±»åˆ«æ€§èƒ½ä¸‹é™
- ç¼“è§£: å®Œæ•´å›å½’æµ‹è¯•ï¼Œä¿ç•™ rollback èƒ½åŠ›

**2. å®ç°å¤æ‚åº¦**
- âš ï¸ æ—¶é—´æ¨ç†å’Œå›¾æŸ¥è¯¢å®ç°å¤æ‚
- ç¼“è§£: åˆ†é˜¶æ®µå®ç°ï¼Œå……åˆ†æµ‹è¯•

**3. API ç¨³å®šæ€§**
- âš ï¸ DeepSeek API å¯èƒ½ä¸ç¨³å®š
- ç¼“è§£: é”™è¯¯é‡è¯•æœºåˆ¶ï¼Œå¤‡ç”¨ API

### 8.2 æ•°æ®è´¨é‡

**1. è®°å¿†æå–è´¨é‡**
- ä¾èµ– LLM è´¨é‡
- éœ€è¦æŒç»­ç›‘æ§å’Œä¼˜åŒ– prompt

**2. æ•°æ®å®Œæ•´æ€§**
- ä½¿ç”¨éªŒè¯è„šæœ¬ç¡®ä¿æ•°æ®å®Œæ•´
- å®šæœŸæ£€æŸ¥æ•°æ®åº“çŠ¶æ€

---

## 9. ç»“è®º

### 9.1 ä¸»è¦æˆå°±

âœ… **æœ¬æ¬¡æµ‹è¯•å–å¾—é‡å¤§çªç ´**:
- Judge Score ä» 0.274 æå‡è‡³ **0.431** (+57.3%)
- æ‰€æœ‰ç±»åˆ«å…¨é¢æå‡
- æµ‹è¯•æµç¨‹è§„èŒƒåŒ–
- æ•°æ®å®Œæ•´æ€§å¾—åˆ°ä¿è¯

### 9.2 ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**ç«‹å³å¼€å§‹ (æœ¬å‘¨)**:
1. å®ç°æ—¶é—´ä¿¡æ¯æå– (P0)
2. å®ç°æ··åˆæ£€ç´¢ BM25 (P0)
3. å»ºç«‹å®Œæ•´çš„æµ‹è¯•éªŒè¯æµç¨‹

**çŸ­æœŸè§„åˆ’ (2 å‘¨å†…)**:
4. ä¼˜åŒ– Fact æå–åŸå­åŒ– (P1)
5. å¢å¼ºçŸ¥è¯†å›¾è°±æ„å»º (P1)
6. ç¬¬ä¸€è½®å®Œæ•´æµ‹è¯•éªŒè¯

**ä¸­æœŸç›®æ ‡ (1 ä¸ªæœˆ)**:
- Overall Judge Score è¾¾åˆ° 0.55+
- Temporal ç±»åˆ«è¾¾åˆ° 0.35+
- å»ºç«‹æŒç»­ä¼˜åŒ–æœºåˆ¶

### 9.3 æˆåŠŸæŒ‡æ ‡

**æŠ€æœ¯æŒ‡æ ‡**:
- [ ] Overall Judge Score â‰¥ 0.55
- [ ] Temporal Judge Score â‰¥ 0.35
- [ ] Single-hop Judge Score â‰¥ 0.60
- [ ] æ‰€æœ‰ç±»åˆ« â‰¥ 0.35

**æµç¨‹æŒ‡æ ‡**:
- [ ] å®Œæ•´æµ‹è¯•è¿è¡Œæ—¶é—´ < 3 å°æ—¶
- [ ] æµ‹è¯•æˆåŠŸç‡ 100% (æ— å¤±è´¥)
- [ ] è‡ªåŠ¨åŒ–ç¨‹åº¦ 90%+

---

## é™„å½•

### A. æµ‹è¯•æ‰§è¡Œæ—¥å¿—

```
2025-02-17 æµ‹è¯•æ—¶é—´çº¿:
17:48 - Ingest å¼€å§‹ (Conv 0-7)
18:45 - Conv 0-7 å®Œæˆï¼ŒConv 8 å¼€å§‹
18:47 - DeepSeek 402 é”™è¯¯
19:00 - Conv 8-9 é‡æ–°å¼€å§‹
19:13 - Ingest å®Œæˆ (14,314 memories)
19:14 - Query å¼€å§‹
20:52 - Query å®Œæˆ (1540/1540)
20:53 - Evaluate å¼€å§‹
21:45 - Evaluate å®Œæˆ
```

### B. å‚è€ƒèµ„æº

- **LoCoMo Paper**: [Long Context Memory Benchmark]
- **æ··åˆæ£€ç´¢**: BM25 + Vector (RRF)
- **æ—¶é—´æ¨ç†**: dateutil, dateparser
- **å›¾æ•°æ®åº“**: Apache AGE (Cypher)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-02-17
**æœ€åæ›´æ–°**: 2025-02-17
**ä½œè€…**: NeuroMemory Eval Team
